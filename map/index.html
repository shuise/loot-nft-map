<!DOCTYPE html>
<html lang="">

<head>
<meta charset="UTF-8">
<title>Game Title Here</title>
<script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
</script>
</head>

<body>
<div id="ph_game"></div>

<script>
const coastData = "596,947L598,939L610,935L622,931L624,924L624,918L622,910L615,902L611,896L604,898L598,901L591,901L585,897L593,894L599,893L606,891L612,889L617,883L622,874L611,869L602,869L604,865L604,853L597,853L595,848L591,844L602,840L608,830L602,823L590,825L583,830L577,830L571,826L574,822L581,821L585,814L592,817L592,808L584,808L583,802L586,795L581,791L580,783L585,778L579,771L582,763L590,761L591,753L601,753L602,764L613,768L619,767L625,774L632,770L629,762L630,757L634,752L642,747L643,758L649,756L651,762L657,764L663,755L665,745L657,742L649,737L640,738L634,742L627,737L620,739L615,739L609,735L618,732L625,728L631,730L638,725L643,718L649,717L654,714L660,714L662,710L656,710L651,711L644,710L636,715L629,723L621,720L613,719L606,716L615,707L623,694L634,702L642,692L655,689L655,677L663,674L668,669L677,670L680,658L678,649L687,639L692,629L701,622L703,612L709,605L704,596L703,584L717,583L732,581L724,573L716,569L708,570L699,570L694,577L689,587L685,599L680,608L676,616L672,616L664,623L661,632L660,639L654,645L650,651L643,656L643,663L639,669L630,668L622,673L618,681L615,686L608,689L597,695L594,703L590,708L582,708L578,713L572,703L584,701L589,696L585,684L576,684L570,685L566,695L559,702L549,698L540,701L540,715L531,722L521,718L522,707L526,699L530,690L542,690L552,682L563,680L565,671L568,661L558,657L563,647L568,647L571,645L567,638L561,643L555,645L552,633L557,628L551,624L548,631L547,641L537,645L528,646L520,643L513,640L509,631L507,621L516,614L517,602L528,600L530,591L517,587L508,595L501,591L500,583L503,576L513,577L527,580L530,573L515,565L518,556L517,546L522,539L518,536L518,530L526,522L535,519L544,513L552,522L560,531L569,529L572,522L579,523L586,522L593,523L598,511L607,506L613,505L618,508L623,505L629,507L635,509L639,503L630,499L625,495L619,494L614,491L606,493L601,489L590,495L577,502L569,499L565,502L556,498L550,492L550,486L540,484L532,487L524,486L521,481L515,471L505,465L505,456L508,451L510,445L506,436L502,446L502,454L498,457L498,464L497,479L485,487L485,496L493,503L494,517L491,523L485,524L479,528L474,534L473,541L466,545L457,546L445,547L436,540L428,547L422,555L413,548L402,541L391,538L383,531L371,526L368,540L362,548L350,541L346,534L337,532L329,535L324,538L317,542L311,536L305,532L300,527L304,518L312,510L319,513L325,512L332,514L339,510L343,514L347,515L352,510L357,499L364,500L367,497L375,492L381,498L380,489L372,486L372,481L376,477L385,475L393,468L400,457L401,450L405,444L410,432L406,421L408,411L409,403L417,398L412,396L406,388L397,388L392,383L393,374L389,365L390,359L390,354L381,348L376,339L382,334L383,329L385,322L389,316L384,308L387,300L396,300L406,302L411,298L413,291L422,292L433,291L441,287L449,281L447,268L458,264L468,258L469,249L465,233L462,226L473,215L480,200L467,200L462,194L468,189L473,192L479,190L485,187L479,180L477,172L484,169L492,170L493,179L495,185L501,188L511,181L505,174L511,165L504,159L503,152L509,140L519,145L522,133L532,143L528,147L533,155L540,149L548,147L547,139L546,131L537,132L525,124L526,116L522,106L530,101L536,107L548,118L552,129L563,127L572,131L574,138L574,145L584,153L584,142L587,134L589,125L585,113L581,106L582,97L576,90L578,80L585,79L592,79L597,89L609,89L623,90L635,89L644,90L648,95L650,103L665,112L679,108L685,108L689,109L695,113L702,116L711,115L723,115L731,122L745,121L756,123L762,131L769,135L773,147L779,154L789,155L795,167L805,175L805,165L799,160L795,151L796,147L794,142L784,143L777,134L767,117L759,113L755,108L751,103L748,100L738,98L730,103L725,100L719,100L719,90L726,86L729,79L722,82L710,83L699,81L689,79L681,80L671,83L657,77L649,68L1000,68";

const borders = [
    "M727,404L719,406L714,403L707,399L698,395L691,392L685,386L684,379L686,373L687,368L687,364L685,361L686,355L689,349L691,342L691,335L691,330L693,325L690,321L684,314L679,310L674,310L671,308L667,303L661,297L656,290L651,284L646,277L644,269L645,262L648,257L649,252L644,249L640,247L642,242L646,235L649,230L653,227L655,220L655,213L653,209L650,204L645,199L640,194L634,189L629,184L626,178L620,173L613,169L610,165L609,158L614,152L618,147L616,143L611,142L606,140L599,133L589,125",
    "M700,436L688,438L677,437L668,436L659,435L652,435L645,434L639,431L636,427L631,425L625,424L619,421L612,419L607,416L602,413L598,411L595,406L590,404L583,404L578,398L572,392L566,389L565,385L561,384L555,385L550,382L546,376L540,374L534,371L528,368L520,364L515,361L512,366L511,371L509,376L503,379L496,376L493,373L491,372L488,372L485,372L481,372L476,371L470,374L464,378L460,380L456,382L452,383L447,385L443,385L442,382L438,378L429,375L421,374L417,373L415,370L409,368L399,366L389,365",
    "M727,404L721,413L714,419L707,419L702,419L699,422L697,428L700,436",
    "M727,404L731,412L737,415L742,418L747,420L753,421L757,426L755,433L752,438L756,439L763,439L770,440L778,440L785,442L790,445L793,450L794,455L797,459L802,459L806,456L809,452L815,453L820,456L824,456L830,459L839,461L849,460L857,459L864,458L870,455L877,454L884,453L891,452L898,451L905,451L911,453L912,457L912,463L914,472L920,479L928,482L937,487L944,493",
    "M700,436L697,441L693,445L691,449L688,452L681,452L673,454L669,458L667,464L663,468L657,469L653,470L652,476L650,481L644,484L638,485L633,487L628,490L625,495",
    "M947,785L942,776L938,767L933,759L927,754L918,752L908,751L900,747L897,742L894,738L889,738L883,736L877,732L870,731L863,728L860,726L856,727L852,730L848,733L846,736L842,735L838,735L832,736L826,738L822,739L820,738L816,735L811,733L807,728L804,724L796,725L787,725L781,723L776,726L770,728L763,727L754,726L747,723L744,718L738,720L730,725L722,726L712,725L703,724L699,718L698,714L696,714L693,715L689,713L682,711L674,709L670,707L666,710L660,714"    
];

function preload (){
    this.load.image("sea", "sea.png");
    this.load.image("plain", "plain.jpg");
}

function create (){
    this.add.image(140, 100, 'sea').setScale(1.7);

    let points = coastData.split('L');

    this.graphics = this.make.graphics();

    this.path = { t: 0, vec: new Phaser.Math.Vector2() };

    this.points = [];

    // https://labs.phaser.io/edit.html?src=src/paths\curves\spline%20curve.js
    // https://labs.phaser.io/edit.html?src=src/game%20objects\rope\rope%20as%20a%20mask.js
    // https://labs.phaser.io/edit.html?src=src/game%20objects\layer\layer%20with%20geometry%20mask.js

    let _this = this;
    // console.log(points);
    points.forEach(function(item){
        item = item.split(',');
        // console.log(item);
        _this.points.push( new Phaser.Math.Vector2(item[0]/1, item[1]/1) );
    })

    this.curve = new Phaser.Curves.Spline(this.points);
}

function update(){
    this.graphics.clear();
    this.graphics.lineStyle(1, 0xffffff, 1);

    this.curve.draw(this.graphics, 64).setScale(1);

    this.graphics.fillStyle(0x00ff00, 2);

    for (let i = 0; i < this.points.length; i++){
        // this.graphics.fillCircle(this.points[i].x, this.points[i].y, 2);
    }

    this.curve.getPoint(this.path.t, this.path.vec);

    this.graphics.fillStyle(0xff0000, 1);
    this.graphics.fillCircle(this.path.vec.x, this.path.vec.y, 8);

    // this.plainLayer = this.add.layer();
    const mask = this.graphics.createGeometryMask();
    this.plainLayer = this.add.image(400, 100, 'plain').setScale(3).setDepth(1000);
    this.plainLayer.setMask(mask);
}


function drawPath(pointsData){
    let _this = this;
    let points = pointsData.split('L');
    _this.graphics = _this.make.graphics();

    _this.path = { t: 0, vec: new Phaser.Math.Vector2() };

    _this.points = [];

    // https://labs.phaser.io/edit.html?src=src/paths\curves\spline%20curve.js
    // https://labs.phaser.io/edit.html?src=src/game%20objects\rope\rope%20as%20a%20mask.js
    // https://labs.phaser.io/edit.html?src=src/game%20objects\layer\layer%20with%20geometry%20mask.js

    // console.log(points);
    points.forEach(function(item){
        item = item.split(',');
        // console.log(item);
        _this.points.push( new Phaser.Math.Vector2(item[0]/1, item[1]/1) );
    })

    _this.curve = new Phaser.Curves.Spline(_this.points);

    _this.graphics.lineStyle(1, 0xffffff, 1);

    _this.curve.draw(_this.graphics, 64).setScale(1);

    _this.graphics.fillStyle(0x00ff00, 2);

    for (let i = 0; i < _this.points.length; i++){
        // this.graphics.fillCircle(this.points[i].x, this.points[i].y, 2);
    }

    _this.curve.getPoint(_this.path.t, _this.path.vec);

    _this.graphics.fillStyle(0xff0000, 1);
    _this.graphics.fillCircle(_this.path.vec.x, _this.path.vec.y, 8);

    // this.plainLayer = this.add.layer();
    const mask = _this.graphics.createGeometryMask();
    _this.plainLayer = _this.add.image(400, 100, 'plain').setScale(3).setDepth(1000);
    _this.plainLayer.setMask(mask);
}

var config = {
    parent: 'ph_game',
    type: Phaser.AUTO,
    width: 1000,
    height: 950,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);

</script>
</body>

</html>